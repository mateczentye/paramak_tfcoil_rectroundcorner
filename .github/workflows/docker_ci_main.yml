name: Pytest - CI for Docker

on:
  pull_request:    
    branches:
    - develop  
    - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Build and test with Docker
      run: |
        ci_env=`bash <(curl -s https://codecov.io/env)`
        docker build -t paramak_tfcoil_rectroundcorner .
        docker run --rm paramak_tfcoil_rectroundcorner /bin/bash -c "bash run_tests.sh" 
    - name: Upload to Codecov
      uses: codecov/codecov-action@v1
      with:
        token: ${{ secrets.CODECOV_TOKEN }}
        fail_ci_if_error: true
        functionalities: coveragepy
        verbose: true